---
layout: post
title: "堆栈平衡与对齐"
tags: [asm, 理解计算机]
---
{% include JB/setup %}

###调用约定
　　C语言的种种调用约定中，以__cdecl最为常见，本小节以__cdecl约定为切入点，剖析计算机在函数调用过程的细节，主要分析堆栈的状态变化。

　　调用过程主要分以下几个阶段<sup>[【1】](#【1】)</sup>：
#####参数压栈
　　自右向左将参数逐一压栈。在编译过程中，编译器会根据压栈参数所占用的空间大小，生成相应的代码，用于函数返回时释放这段空间。释放空间的本质只是将esp指针加上释放的长度，并不对释放的空间做清空处理。
#####函数调用
　　在本阶段，处理器将执行call指令，具体操作是：将指令寄存器eip压栈，并跳转到被调用函数的起始地址。相当于连续执行了push和jmp指令。
#####处理ebp寄存器
　　。
#####保护寄存器状态
　　。
#####分配局部变量空间
　　。
#####执行函数
　　。
#####释放局部变量空间
　　。
#####恢复寄存器状态
　　。
#####处理ebp寄存器
　　。
#####函数返回
　　。
#####释放参数空间
　　。
###堆栈对齐
　　。
>　　堆栈对齐

###参考
<span id="【1】"></span>【1】 [http://www.unixwiz.net/techtips/win32-callconv-asm.html](http://www.unixwiz.net/techtips/win32-callconv-asm.html)
